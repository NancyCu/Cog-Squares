<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>StrideLab | Goal Setting</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #0c111b;
            --panel: #151c2c;
            --panel-light: #1d263b;
            --text: #e5e7eb;
            --muted: #9aa4b2;
            --accent: #4f8cff;
            --accent-2: #32d4c8;
            --success: #38d39f;
            --warning: #fbbf24;
            --danger: #f87171;
            --border: #27324a;
        }

        * {
            box-sizing: border-box;
            font-family: "Inter", sans-serif;
        }

        body {
            margin: 0;
            background: radial-gradient(circle at top, rgba(79, 140, 255, 0.2), transparent 45%),
                radial-gradient(circle at 20% 80%, rgba(50, 212, 200, 0.18), transparent 40%),
                var(--bg);
            color: var(--text);
            min-height: 100vh;
        }

        header {
            padding: 32px 6vw 24px;
        }

        .eyebrow {
            text-transform: uppercase;
            letter-spacing: 0.18em;
            font-size: 0.7rem;
            color: var(--accent-2);
            font-weight: 600;
        }

        h1 {
            margin: 10px 0 8px;
            font-size: clamp(1.8rem, 3vw, 2.6rem);
        }

        .subtitle {
            color: var(--muted);
            max-width: 720px;
            font-size: 1rem;
            line-height: 1.6;
        }

        main {
            padding: 0 6vw 40px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 24px;
        }

        .panel {
            background: var(--panel);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 20px;
            box-shadow: 0 18px 35px rgba(6, 12, 23, 0.4);
        }

        .panel h2 {
            margin: 0 0 16px;
            font-size: 1.2rem;
        }

        .summary-grid {
            display: grid;
            gap: 16px;
        }

        .summary-card {
            background: var(--panel-light);
            border-radius: 12px;
            padding: 16px;
            display: grid;
            gap: 8px;
            border: 1px solid transparent;
        }

        .summary-card strong {
            font-size: 1.4rem;
        }

        .metric-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            color: var(--muted);
            font-size: 0.85rem;
        }

        .pill {
            padding: 4px 10px;
            border-radius: 999px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .pill.success {
            background: rgba(56, 211, 159, 0.18);
            color: var(--success);
        }

        .pill.warning {
            background: rgba(251, 191, 36, 0.16);
            color: var(--warning);
        }

        .pill.info {
            background: rgba(79, 140, 255, 0.18);
            color: var(--accent);
        }

        form {
            display: grid;
            gap: 12px;
        }

        label {
            display: block;
            font-size: 0.85rem;
            color: var(--muted);
            margin-bottom: 6px;
        }

        input, select {
            width: 100%;
            padding: 10px 12px;
            border-radius: 10px;
            border: 1px solid var(--border);
            background: #101728;
            color: var(--text);
            font-size: 0.95rem;
        }

        button {
            padding: 12px 16px;
            border-radius: 10px;
            border: none;
            background: linear-gradient(120deg, var(--accent), #7a5cff);
            color: white;
            font-weight: 600;
            cursor: pointer;
        }

        button.secondary {
            background: #1f2a42;
            color: var(--text);
            border: 1px solid var(--border);
        }

        .goals-list {
            display: grid;
            gap: 16px;
        }

        .goal-card {
            background: var(--panel-light);
            border-radius: 16px;
            padding: 16px;
            display: grid;
            gap: 12px;
            border: 1px solid rgba(79, 140, 255, 0.15);
        }

        .goal-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 8px;
        }

        .goal-title {
            font-weight: 600;
        }

        .goal-meta {
            color: var(--muted);
            font-size: 0.85rem;
        }

        .progress-wrap {
            display: flex;
            align-items: center;
            gap: 14px;
        }

        .progress-ring {
            width: 62px;
            height: 62px;
            border-radius: 50%;
            background: conic-gradient(var(--accent) 0deg, rgba(79, 140, 255, 0.2) 0deg);
            display: grid;
            place-items: center;
        }

        .progress-ring span {
            font-size: 0.8rem;
            font-weight: 600;
            color: var(--text);
        }

        .progress-bar {
            flex: 1;
            height: 10px;
            background: #0f172a;
            border-radius: 999px;
            overflow: hidden;
        }

        .progress-bar div {
            height: 100%;
            border-radius: inherit;
            background: linear-gradient(90deg, var(--accent-2), var(--accent));
            width: 0;
        }

        .goal-actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .goal-actions button {
            padding: 8px 12px;
            font-size: 0.8rem;
        }

        .empty-state {
            text-align: center;
            color: var(--muted);
            padding: 16px 0 8px;
            font-size: 0.95rem;
        }

        .mini-chart {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
            align-items: end;
            height: 140px;
        }

        .mini-bar {
            background: linear-gradient(180deg, rgba(79, 140, 255, 0.6), rgba(50, 212, 200, 0.3));
            border-radius: 10px 10px 6px 6px;
            position: relative;
            min-height: 20px;
        }

        .mini-bar span {
            position: absolute;
            bottom: -20px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 0.75rem;
            color: var(--muted);
        }

        .trend-note {
            margin-top: 12px;
            color: var(--muted);
            font-size: 0.85rem;
        }

        @media (max-width: 720px) {
            main {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="eyebrow">Goal Studio</div>
        <h1>Set running goals and visualize your progress.</h1>
        <p class="subtitle">
            Define custom goals for weekly distance, monthly run counts, or pace improvement.
            StrideLab tracks your activity summary and turns it into clear progress feedback.
        </p>
    </header>

    <main>
        <section class="panel">
            <h2>Activity snapshot</h2>
            <div class="summary-grid" id="summary-grid"></div>
            <form id="activity-form" aria-label="Update activity data">
                <div>
                    <label for="weekly-distance">Weekly distance (mi)</label>
                    <input id="weekly-distance" type="number" step="0.1" min="0" />
                </div>
                <div>
                    <label for="monthly-runs">Runs this month</label>
                    <input id="monthly-runs" type="number" min="0" />
                </div>
                <div>
                    <label for="baseline-pace">Baseline pace (mm:ss)</label>
                    <input id="baseline-pace" type="text" placeholder="10:15" />
                </div>
                <div>
                    <label for="current-pace">Current pace (mm:ss)</label>
                    <input id="current-pace" type="text" placeholder="9:45" />
                </div>
                <button type="submit">Update snapshot</button>
            </form>
        </section>

        <section class="panel">
            <h2>Create a goal</h2>
            <form id="goal-form">
                <div>
                    <label for="goal-type">Goal type</label>
                    <select id="goal-type">
                        <option value="distance">Total distance per week</option>
                        <option value="runs">Number of runs per month</option>
                        <option value="pace">Average pace improvement</option>
                    </select>
                </div>
                <div>
                    <label for="goal-target">Target value</label>
                    <input id="goal-target" type="number" min="0.1" step="0.1" placeholder="Example: 20" />
                </div>
                <div>
                    <label for="goal-notes">Why it matters (optional)</label>
                    <input id="goal-notes" type="text" placeholder="Stay consistent before race day" />
                </div>
                <button type="submit">Add goal</button>
            </form>
        </section>

        <section class="panel">
            <h2>Goal progress</h2>
            <div class="goals-list" id="goals-list"></div>
            <div class="empty-state" id="empty-state">No goals yet. Add one to start tracking.</div>
        </section>

        <section class="panel">
            <h2>Weekly distance trend</h2>
            <div class="mini-chart" id="trend-chart"></div>
            <p class="trend-note" id="trend-note"></p>
        </section>
    </main>

    <script>
        const STORAGE_KEY = 'stride-goals-v1';
        const ACTIVITY_KEY = 'stride-activity-v1';

        const goalForm = document.getElementById('goal-form');
        const goalsList = document.getElementById('goals-list');
        const emptyState = document.getElementById('empty-state');
        const summaryGrid = document.getElementById('summary-grid');
        const trendChart = document.getElementById('trend-chart');
        const trendNote = document.getElementById('trend-note');
        const activityForm = document.getElementById('activity-form');

        let goals = [];
        let activity = {
            weeklyDistance: 18.4,
            monthlyRuns: 9,
            baselinePace: '10:15',
            currentPace: '9:40',
            weeklyTrend: [14.2, 16.8, 18.4, 19.1]
        };

        const paceToSeconds = (pace) => {
            if (!pace || !pace.includes(':')) {
                return null;
            }
            const [minutes, seconds] = pace.split(':').map((value) => parseInt(value, 10));
            if (Number.isNaN(minutes) || Number.isNaN(seconds)) {
                return null;
            }
            return minutes * 60 + seconds;
        };

        const secondsToPace = (seconds) => {
            if (seconds === null || Number.isNaN(seconds)) {
                return '--:--';
            }
            const mins = Math.floor(seconds / 60);
            const secs = Math.max(0, Math.round(seconds - mins * 60));
            return `${mins}:${String(secs).padStart(2, '0')}`;
        };

        const loadState = () => {
            const storedGoals = localStorage.getItem(STORAGE_KEY);
            if (storedGoals) {
                goals = JSON.parse(storedGoals);
            } else {
                goals = [
                    { id: 1, type: 'distance', target: 22, notes: 'Build weekly volume.' },
                    { id: 2, type: 'runs', target: 12, notes: 'Stay consistent with cadence.' },
                    { id: 3, type: 'pace', target: 30, notes: 'Cut 30s off average pace.' }
                ];
            }

            const storedActivity = localStorage.getItem(ACTIVITY_KEY);
            if (storedActivity) {
                activity = JSON.parse(storedActivity);
            }
        };

        const saveState = () => {
            localStorage.setItem(STORAGE_KEY, JSON.stringify(goals));
            localStorage.setItem(ACTIVITY_KEY, JSON.stringify(activity));
        };

        const goalLabels = {
            distance: 'Weekly distance goal',
            runs: 'Monthly runs goal',
            pace: 'Pace improvement goal'
        };

        const goalUnits = {
            distance: 'mi',
            runs: 'runs',
            pace: 'sec'
        };

        const computeGoalProgress = (goal) => {
            if (goal.type === 'distance') {
                return {
                    current: activity.weeklyDistance,
                    target: goal.target,
                    unit: 'mi',
                    metricLabel: 'this week'
                };
            }
            if (goal.type === 'runs') {
                return {
                    current: activity.monthlyRuns,
                    target: goal.target,
                    unit: 'runs',
                    metricLabel: 'this month'
                };
            }
            const baseline = paceToSeconds(activity.baselinePace);
            const current = paceToSeconds(activity.currentPace);
            const improvement = baseline !== null && current !== null ? Math.max(0, baseline - current) : 0;
            return {
                current: improvement,
                target: goal.target,
                unit: 'sec',
                metricLabel: `baseline ${activity.baselinePace}`
            };
        };

        const progressStatus = (percent) => {
            if (percent >= 1) {
                return { text: 'Achieved', className: 'success' };
            }
            if (percent >= 0.6) {
                return { text: 'On track', className: 'info' };
            }
            return { text: 'Behind', className: 'warning' };
        };

        const renderSummary = () => {
            summaryGrid.innerHTML = '';
            const cards = [
                {
                    title: 'Weekly distance',
                    value: `${activity.weeklyDistance.toFixed(1)} mi`,
                    note: `${activity.weeklyTrend[activity.weeklyTrend.length - 1].toFixed(1)} mi latest`
                },
                {
                    title: 'Runs this month',
                    value: `${activity.monthlyRuns}`,
                    note: 'Goal cadence on track'
                },
                {
                    title: 'Average pace',
                    value: activity.currentPace,
                    note: `Baseline ${activity.baselinePace}`
                }
            ];

            cards.forEach((card) => {
                const container = document.createElement('div');
                container.className = 'summary-card';
                container.innerHTML = `
                    <div class="metric-row">${card.title}</div>
                    <strong>${card.value}</strong>
                    <div class="metric-row">${card.note}</div>
                `;
                summaryGrid.appendChild(container);
            });
        };

        const renderGoals = () => {
            goalsList.innerHTML = '';
            emptyState.style.display = goals.length ? 'none' : 'block';

            goals.forEach((goal) => {
                const progress = computeGoalProgress(goal);
                const percent = Math.min(progress.current / progress.target, 1);
                const status = progressStatus(percent);
                const ringDegrees = Math.round(percent * 360);

                const card = document.createElement('article');
                card.className = 'goal-card';
                card.innerHTML = `
                    <div class="goal-header">
                        <div>
                            <div class="goal-title">${goalLabels[goal.type]}</div>
                            <div class="goal-meta">Target ${goal.target} ${goalUnits[goal.type]}</div>
                        </div>
                        <span class="pill ${status.className}">${status.text}</span>
                    </div>
                    <div class="progress-wrap">
                        <div class="progress-ring" style="background: conic-gradient(var(--accent) ${ringDegrees}deg, rgba(79, 140, 255, 0.2) ${ringDegrees}deg);">
                            <span>${Math.round(percent * 100)}%</span>
                        </div>
                        <div style="flex: 1;">
                            <div class="goal-meta">${progress.current.toFixed(1)} / ${goal.target} ${progress.unit} ${progress.metricLabel}</div>
                            <div class="progress-bar"><div style="width: ${Math.round(percent * 100)}%"></div></div>
                        </div>
                    </div>
                    ${goal.notes ? `<div class="goal-meta">${goal.notes}</div>` : ''}
                    <div class="goal-actions">
                        <div class="goal-meta">Updated today</div>
                        <button class="secondary" data-id="${goal.id}">Remove</button>
                    </div>
                `;
                goalsList.appendChild(card);
            });
        };

        const renderTrend = () => {
            trendChart.innerHTML = '';
            const trend = activity.weeklyTrend;
            const maxValue = Math.max(...trend, 1);

            trend.forEach((value, index) => {
                const bar = document.createElement('div');
                bar.className = 'mini-bar';
                bar.style.height = `${(value / maxValue) * 100}%`;
                bar.innerHTML = `<span>W${index + 1}</span>`;
                trendChart.appendChild(bar);
            });

            const change = trend[trend.length - 1] - trend[0];
            const direction = change >= 0 ? 'up' : 'down';
            trendNote.textContent = `Distance trend is ${direction} ${Math.abs(change).toFixed(1)} miles over the last four weeks.`;
        };

        const hydrateActivityForm = () => {
            document.getElementById('weekly-distance').value = activity.weeklyDistance;
            document.getElementById('monthly-runs').value = activity.monthlyRuns;
            document.getElementById('baseline-pace').value = activity.baselinePace;
            document.getElementById('current-pace').value = activity.currentPace;
        };

        const refreshUI = () => {
            renderSummary();
            renderGoals();
            renderTrend();
        };

        goalForm.addEventListener('submit', (event) => {
            event.preventDefault();
            const type = document.getElementById('goal-type').value;
            const target = parseFloat(document.getElementById('goal-target').value);
            const notes = document.getElementById('goal-notes').value.trim();

            if (!target || target <= 0) {
                return;
            }

            const id = goals.length ? Math.max(...goals.map((goal) => goal.id)) + 1 : 1;
            goals.unshift({ id, type, target, notes });
            goalForm.reset();
            saveState();
            refreshUI();
        });

        goalsList.addEventListener('click', (event) => {
            const target = event.target;
            if (target.tagName !== 'BUTTON') {
                return;
            }
            const id = Number(target.dataset.id);
            goals = goals.filter((goal) => goal.id !== id);
            saveState();
            refreshUI();
        });

        activityForm.addEventListener('submit', (event) => {
            event.preventDefault();
            const weeklyDistance = parseFloat(document.getElementById('weekly-distance').value);
            const monthlyRuns = parseInt(document.getElementById('monthly-runs').value, 10);
            const baselinePace = document.getElementById('baseline-pace').value.trim();
            const currentPace = document.getElementById('current-pace').value.trim();

            activity.weeklyDistance = Number.isNaN(weeklyDistance) ? activity.weeklyDistance : weeklyDistance;
            activity.monthlyRuns = Number.isNaN(monthlyRuns) ? activity.monthlyRuns : monthlyRuns;
            activity.baselinePace = baselinePace || activity.baselinePace;
            activity.currentPace = currentPace || activity.currentPace;

            const latestTrend = activity.weeklyTrend.slice(1);
            latestTrend.push(activity.weeklyDistance);
            activity.weeklyTrend = latestTrend;

            saveState();
            refreshUI();
        });

        loadState();
        hydrateActivityForm();
        refreshUI();
    </script>
</body>
</html>
